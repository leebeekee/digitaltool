<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ë³„ ê°œì¸ í‰ê°€ ë° ê²°ê³¼</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        /* Shared Styles Reuse from style.css but specific overrides */
        .eval-container {
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
        }

        .group-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
            animation: fadeInUp 0.8s ease-out;
        }

        .group-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .group-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-color);
        }

        .group-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary-color);
            border-radius: 999px;
            font-size: 0.8rem;
            color: white;
            margin-bottom: 0.5rem;
        }

        .group-members {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            line-height: 1.4;
        }

        /* Vote Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            color: white;
            position: relative;
            animation: zoomIn 0.3s ease-out;
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .rating-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .rating-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 1rem;
        }

        .rating-options {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 0.5rem;
        }

        .rating-option {
            flex: 1;
            text-align: center;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background 0.2s;
            color: #94a3b8;
        }

        .rating-option.selected {
            background: var(--primary-color);
            color: white;
            font-weight: bold;
        }

        /* Admin Dashboard Styles */
        .admin-panel {
            display: none;
            /* Hidden by default */
            background: rgba(15, 23, 42, 0.95);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            color: #fff;
            margin-top: 1rem;
        }

        .ranking-table th,
        .ranking-table td {
            text-align: left;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ranking-table th {
            background: rgba(255, 255, 255, 0.05);
            color: var(--primary-color);
        }

        .rank-badge {
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #334155;
            border-radius: 50%;
            font-weight: bold;
        }

        .rank-1 {
            background: #eab308;
            color: black;
        }

        /* Gold */
        .rank-2 {
            background: #94a3b8;
            color: black;
        }

        /* Silver */
        .rank-3 {
            background: #b45309;
            color: black;
        }

        /* Bronze */

        .login-mini-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.5);
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="background-animation"></div>

    <main class="eval-container">
        <header class="hero" style="margin-bottom: 2rem;">
            <div style="display:flex; align-items:center; justify-content:center; position:relative;">
                <h1 class="main-title" style="margin:0;">ì¡°ë³„ ì‘í’ˆ í‰ê°€</h1>
                <button id="adminLoginTrigger" class="login-mini-btn">ê´€ë¦¬ì</button>
            </div>
            <p class="subtitle" style="margin-top:1rem;">ê° ì¡°ì˜ ì‘í’ˆì„ ê°ìƒí•˜ê³  ê³µì •í•˜ê²Œ í‰ê°€í•´ì£¼ì„¸ìš”.</p>
        </header>

        <nav class="back-nav" style="display: flex; gap: 1rem; align-items: center;">
            <a href="index.html" class="back-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                í™ˆìœ¼ë¡œ
            </a>
            <!-- Config button will be inserted here by script -->
        </nav>

        <div id="groupGrid" class="group-grid">
            <!-- Cards injected via JS -->
        </div>

        <div style="margin-top: 3rem; text-align: right; opacity: 0.5;">
            <button onclick="resetEvaluationFooter()"
                style="background:none; border:none; color:#94a3b8; font-size:0.8rem; cursor:pointer;">âš™ï¸ ë°ì´í„° ì´ˆê¸°í™”
                (ê´€ë¦¬ììš©)</button>
        </div>
    </main>

    <!-- Vote Modal -->
    <div id="voteModal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modalGroupTitle" style="margin-bottom: 1.5rem;">1ì¡° í‰ê°€í•˜ê¸°</h2>

            <form id="voteForm">
                <input type="hidden" id="targetGroupId">

                <div class="rating-group">
                    <label class="rating-label">ì°½ì˜ì„± (ê°€ì¤‘ì¹˜ 0.5)</label>
                    <div class="rating-options" data-field="creativity">
                        <div class="rating-option" onclick="selectRating('creativity', 1)">1</div>
                        <div class="rating-option" onclick="selectRating('creativity', 2)">2</div>
                        <div class="rating-option" onclick="selectRating('creativity', 3)">3</div>
                        <div class="rating-option" onclick="selectRating('creativity', 4)">4</div>
                        <div class="rating-option" onclick="selectRating('creativity', 5)">5</div>
                    </div>
                </div>

                <div class="rating-group">
                    <label class="rating-label">ì™„ì„±ë„ (ê°€ì¤‘ì¹˜ 0.4)</label>
                    <div class="rating-options" data-field="completeness">
                        <div class="rating-option" onclick="selectRating('completeness', 1)">1</div>
                        <div class="rating-option" onclick="selectRating('completeness', 2)">2</div>
                        <div class="rating-option" onclick="selectRating('completeness', 3)">3</div>
                        <div class="rating-option" onclick="selectRating('completeness', 4)">4</div>
                        <div class="rating-option" onclick="selectRating('completeness', 5)">5</div>
                    </div>
                </div>

                <div class="rating-group">
                    <label class="rating-label">ë””ìì¸ (ê°€ì¤‘ì¹˜ 0.1)</label>
                    <div class="rating-options" data-field="design">
                        <div class="rating-option" onclick="selectRating('design', 1)">1</div>
                        <div class="rating-option" onclick="selectRating('design', 2)">2</div>
                        <div class="rating-option" onclick="selectRating('design', 3)">3</div>
                        <div class="rating-option" onclick="selectRating('design', 4)">4</div>
                        <div class="rating-option" onclick="selectRating('design', 5)">5</div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">í‰ê°€ ì œì¶œí•˜ê¸°</button>
                <button type="button" class="submit-btn"
                    style="background: transparent; border: 1px solid rgba(255,255,255,0.2); margin-top: 0.5rem;"
                    onclick="closeModal()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <div style="max-width: 1000px; margin: 0 auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 2rem;">
                <h2 style="color:white; font-size:2rem;">ğŸ“Š ì¡°ë³„ í‰ê°€ ìˆœìœ„ (ê´€ë¦¬ì)</h2>
                <div style="display:flex; gap:0.5rem;">
                    <button onclick="resetEvaluationData()" class="submit-btn"
                        style="width:auto; padding:0.5rem 1rem; background: #ef4444; font-size:0.9rem;">ë°ì´í„° ì´ˆê¸°í™”</button>
                    <button onclick="closeAdminPanel()" class="submit-btn"
                        style="width:auto; padding:0.5rem 1.5rem; background: #475569;">ë‹«ê¸°</button>
                </div>
            </div>

            <!-- Login Form inside Admin Panel (if not logged in) -> Actually, I'll use a prompt or simple overlay logic in JS -->

            <table class="ranking-table">
                <thead>
                    <tr>
                        <th width="10%">ìˆœìœ„</th>
                        <th width="20%">ì¡°</th>
                        <th width="30%">ì°¸ì—¬ì</th>
                        <th width="15%">ì°¸ì—¬ íšŸìˆ˜</th>
                        <th>ì´ì  (Weighted Total)</th>
                    </tr>
                </thead>
                <tbody id="rankingBody">
                    <!-- Rows -->
                    <tr>
                        <td colspan="5" style="text-align:center">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Reusing the script structure from group_site with additions -->
    <script>
        // Data Definitions
        const groups = [
            { id: 1, members: "ê¹€ìœ¤í¬, ë°•ë³´ê²½, ë°•í•˜ì§„, ì¡°ì€ìˆ™" },
            { id: 2, members: "ê¹€ì„±ë•, ì†¡ì„œí¬, ë°•ì£¼ì—°, ê¹€ì‹ í˜œ" },
            { id: 3, members: "ì—„ì•„ëŒ, ì„í™”ì •, ì˜¤ì•„ì˜, ì•ˆì§„ì˜" },
            { id: 4, members: "ê¶Œì •ìœ¤, ê¹€ë¯¸ì§„, ì‹œì§€í˜œ" },
            { id: 5, members: "ì‹ ë¡, ì„ë¹›ë‚˜, ì •ìœ ì§„, í™ì •í˜œ" },
            { id: 6, members: "ë°•ë¯¼ì£¼, ë°•ìˆ˜ë€, ì„ë¯¼í¬, ë¥˜í˜„ì •" },
            { id: 7, members: "ë³€ì§€ì„ , ì‹ ì„ í˜œ, ê°•ì •í•œ" },
            { id: 8, members: "ìµœìš´ì˜, ê¹€ì˜ì€, ìœ¤í˜„ìˆ™, ì´ìœ¤ì •" },
            { id: 9, members: "ì¡°í•œìˆ™, ê¹€ì˜ë¦¼, ìœ ìŠ¹í¬, ì´ìš©í¬" },
            { id: 10, members: "ì§„ì°½ì™„, ì •ì˜ìˆ™, ê¹€í™ì§„, í•˜ë°±í™”" },
            { id: 11, members: "ì‚¬íšŒ ON ë…ì„œ ON(ê¹€ì†Œì˜, ê¹€ì£¼í¬, ê¹€í•œì†”, ë°•ì˜ì• , ì‹ ìœ¤í•´, ìœ¤ìš°í¬)" }
        ];

        let currentRatings = { creativity: 0, completeness: 0, design: 0 };
        
        // ì´ˆê¸° ì„¤ì •
        let githubConfig = {
            owner: 'leebeekee',
            repo: 'digitaltool',
            path: 'eval_data.json', // ì´ í˜ì´ì§€ëŠ” í•­ìƒ evaluation dataë¥¼ ì‚¬ìš©
            token: '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' 
        };

        const DEFAULTS = { message: "Update evaluation data", committer: { name: "Digital Tool Web", email: "web@digitaltool.com" } };

        document.addEventListener('DOMContentLoaded', () => {
            loadConfig(); // ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            renderGroups();
            setupAdminLogic();
            setupConfigButton(); // ì„¤ì • ë²„íŠ¼ ì¶”ê°€
        });

        // ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° (pathëŠ” ë®ì–´ì“°ì§€ ì•Šë„ë¡ ì£¼ì˜)
        function loadConfig() {
            const saved = localStorage.getItem('gh_config_v2');
            if (saved) {
                const savedConfig = JSON.parse(saved);
                githubConfig.owner = savedConfig.owner || githubConfig.owner;
                githubConfig.repo = savedConfig.repo || githubConfig.repo;
                githubConfig.token = savedConfig.token || githubConfig.token;
                // pathëŠ” ì €ì¥ëœ ì„¤ì •ì—ì„œ ê°€ì ¸ì˜¤ì§€ ì•Šê³  ê³ ì •ê°’ ì‚¬ìš©
            }
        }

        function renderGroups() {
            const grid = document.getElementById('groupGrid');
            grid.innerHTML = groups.map(g => `
                <div class="group-card" onclick="openVoteModal(${g.id}, '${g.members}')">
                    <span class="group-badge">${g.id}ì¡°</span>
                    <h3 style="color:white; margin: 0.5rem 0;">${g.id === 11 ? 'ì‚¬íšŒ ON ë…ì„œ ON' : `${g.id}ì¡° í”„ë¡œì íŠ¸`}</h3>
                    <p class="group-members">${g.members}</p>
                </div>
            `).join('');
        }

        // --- Vote UI Logic ---
        window.openVoteModal = function (id, members) {
            document.getElementById('voteModal').style.display = 'flex';
            document.getElementById('modalGroupTitle').innerText = `${id}ì¡° í‰ê°€í•˜ê¸°`;
            document.getElementById('targetGroupId').value = id;
            currentRatings = { creativity: 0, completeness: 0, design: 0 };
            updateRatingUI();
        }

        window.closeModal = function () {
            document.getElementById('voteModal').style.display = 'none';
        }

        window.selectRating = function (field, value) {
            currentRatings[field] = value;
            updateRatingUI();
        }

        function updateRatingUI() {
            ['creativity', 'completeness', 'design'].forEach(field => {
                const container = document.querySelector(`.rating-options[data-field="${field}"]`);
                Array.from(container.children).forEach((el, idx) => {
                    if ((idx + 1) === currentRatings[field]) el.classList.add('selected');
                    else el.classList.remove('selected');
                });
            });
        }

        document.getElementById('voteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentRatings.creativity || !currentRatings.completeness || !currentRatings.design) {
                alert("ëª¨ë“  í•­ëª©ì„ í‰ê°€í•´ì£¼ì„¸ìš”.");
                return;
            }

            if (!githubConfig.token) {
                alert("ì—°ë™ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ìš°ì¸¡ ìƒë‹¨ âš™ï¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„¤ì •í•´ì£¼ì„¸ìš”.");
                closeModal();
                openSettings();
                return;
            }

            // Calculate Score
            // W: 0.5, 0.4, 0.1
            const score = (currentRatings.creativity * 0.5) + (currentRatings.completeness * 0.4) + (currentRatings.design * 0.1);

            const voteData = {
                groupId: parseInt(document.getElementById('targetGroupId').value),
                scores: { ...currentRatings },
                finalScore: parseFloat(score.toFixed(2)),
                timestamp: new Date().toISOString()
            };

            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerText = "ì œì¶œ ì¤‘...";
            btn.disabled = true;

            try {
                // Update GitHub
                const currentFile = await fetchFileContent();
                currentFile.content.push(voteData);
                await updateFileContent(currentFile.content, currentFile.sha);

                alert("í‰ê°€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!");
                closeModal();
            } catch (err) {
                console.error(err);
                if (err.message.includes('401')) {
                    alert("ì¸ì¦ ì˜¤ë¥˜(401): í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    openSettings();
                } else {
                    alert("ì˜¤ë¥˜ ë°œìƒ: " + err.message);
                }
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });

        // --- Admin Logic ---
        function setupAdminLogic() {
            const adminPanel = document.getElementById('adminPanel');
            document.getElementById('adminLoginTrigger').onclick = async () => {
                // Simple Check
                const isAdmin = sessionStorage.getItem('isAdmin');
                if (!isAdmin) {
                    const id = prompt("ê´€ë¦¬ì ID:");
                    const pw = prompt("ê´€ë¦¬ì PW:");
                    if (id === 'abc' && pw === '1234') {
                        sessionStorage.setItem('isAdmin', 'true');
                        openAdminPanel();
                    } else {
                        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨");
                    }
                } else {
                    openAdminPanel();
                }
            };
        }

        async function openAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            await loadRankings();
        }

        window.closeAdminPanel = function () {
            document.getElementById('adminPanel').style.display = 'none';
        }

        window.resetEvaluationFooter = async function () {
            if (!githubConfig.token) {
                 alert("GitHub ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                 openSettings();
                 return;
            }
            // Re-use logic or call the same function prompt
            if (!confirm("âš ï¸ ê²½ê³ : ëª¨ë“  í‰ê°€ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤!\nì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (pw !== '1234') {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }

            // Proceed to reset
            try {
                const currentFile = await fetchFileContent();
                await updateFileContent([], currentFile.sha);
                alert("ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            } catch (err) {
                alert("ì´ˆê¸°í™” ì‹¤íŒ¨: " + err.message);
            }
        }

        window.resetEvaluationData = async function () {
             if (!githubConfig.token) {
                 alert("GitHub ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                 openSettings();
                 return;
            }
            if (!confirm("âš ï¸ ê²½ê³ : ëª¨ë“  í‰ê°€ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤!\nì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            // Double check
            const pw = prompt("ì´ˆê¸°í™”ë¥¼ ìŠ¹ì¸í•˜ë ¤ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸(1234)ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (pw !== '1234') {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }

            try {
                // Fetch info first to get sha
                const currentFile = await fetchFileContent();
                // Overwrite with empty array
                await updateFileContent([], currentFile.sha);
                alert("ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
                loadRankings(); // Refresh view
            } catch (err) {
                alert("ì´ˆê¸°í™” ì‹¤íŒ¨: " + err.message);
            }
        }

        async function loadRankings() {
            if (!githubConfig.token) {
                // Fail silently or show setup message
                document.getElementById('rankingBody').innerHTML = '<tr><td colspan="5" style="text-align:center;">GitHub ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.<br><button onclick="openSettings()" style="margin-top:10px; color:black;">ì„¤ì •í•˜ê¸°</button></td></tr>';
                return;
            }

            const tbody = document.getElementById('rankingBody');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:2rem;">ì ìˆ˜ ê³„ì‚° ì¤‘...</td></tr>';

            try {
                // Get data
                const currentFile = await fetchFileContent(); // returns { content: [] }
                const votes = currentFile.content;

                // Aggregate
                // Map: GroupID -> { totalScore: 0, count: 0 }
                const agg = {};
                groups.forEach(g => agg[g.id] = { ...g, totalScore: 0, count: 0 });

                votes.forEach(v => {
                    if (agg[v.groupId]) {
                        agg[v.groupId].totalScore += v.finalScore;
                        agg[v.groupId].count += 1;
                    }
                });

                // Convert to array and sort
                const ranking = Object.values(agg).sort((a, b) => b.totalScore - a.totalScore);

                // Render
                tbody.innerHTML = ranking.map((r, idx) => {
                    let rankClass = '';
                    if (idx === 0) rankClass = 'rank-1';
                    else if (idx === 1) rankClass = 'rank-2';
                    else if (idx === 2) rankClass = 'rank-3';

                    return `
                        <tr>
                            <td><span class="rank-badge ${rankClass}">${idx + 1}</span></td>
                            <td>${r.id}ì¡°</td>
                            <td style="font-size:0.9rem; color:#cbd5e1;">${r.members}</td>
                            <td>${r.count}ëª…</td>
                            <td style="font-weight:bold; color:var(--primary-color);">${r.totalScore.toFixed(2)}ì </td>
                        </tr>
                    `;
                }).join('');

            } catch (err) {
                console.error(err);
                if (err.message.includes('401')) {
                     tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:#fca5a5;">ì¸ì¦ ì˜¤ë¥˜: í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. <button onclick="openSettings()">ì„¤ì • ë³€ê²½</button></td></tr>`;
                } else {
                     tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:red;">ë¡œë“œ ì‹¤íŒ¨: ${err.message}</td></tr>`;
                }
            }
        }

        // --- Shared GitHub API Logic ---

        function setupConfigButton() {
            const nav = document.querySelector('.back-nav');
            if(nav) {
                const btn = document.createElement('button');
                btn.innerHTML = 'âš™ï¸ GitHub ì„¤ì •';
                btn.className = 'login-mini-btn';
                btn.style.marginLeft = 'auto'; // Right align similar to flex auto margins
                btn.onclick = openSettings;
                nav.appendChild(btn);
            }
        }

        async function fetchFileContent() {
            const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.path}`;
            const response = await fetch(url, { headers: { 'Authorization': `token ${githubConfig.token}`, 'Accept': 'application/vnd.github.v3+json' } });
            
            if (!response.ok) {
                if(response.status === 401) throw new Error("GitHub ì ‘ì† ì‹¤íŒ¨ (401 Unauthorized)");
                if (response.status === 404) return { content: [], sha: null };
                throw new Error(`GitHub ì ‘ì† ì‹¤íŒ¨ (${response.status})`);
            }
            
            const data = await response.json();
            const decodedContent = decodeURIComponent(escape(atob(data.content.replace(/\n/g, ""))));
            return { content: JSON.parse(decodedContent), sha: data.sha };
        }

        async function updateFileContent(newContent, sha) {
            const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.path}`;
            const contentString = JSON.stringify(newContent, null, 2);
            const encodedContent = btoa(unescape(encodeURIComponent(contentString)));
            const body = { message: DEFAULTS.message, committer: DEFAULTS.committer, content: encodedContent };
            if (sha) body.sha = sha;
            
            const response = await fetch(url, { 
                method: 'PUT', 
                headers: { 
                    'Authorization': `token ${githubConfig.token}`, 
                    'Accept': 'application/vnd.github.v3+json', 
                    'Content-Type': 'application/json' 
                }, 
                body: JSON.stringify(body) 
            });
            
            if (!response.ok) {
                 if(response.status === 401) throw new Error("401 Unauthorized");
                 throw new Error("ì €ì¥ ì‹¤íŒ¨");
            }
        }

        window.openSettings = function () {
            const overlay = document.createElement('div');
            overlay.style.cssText = `position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:3000;display:flex;justify-content:center;align-items:center;`;
            
            // Reuse the style from group_site somewhat but inline for standalone
            overlay.innerHTML = `
                <div class="row" style="background:var(--glass-bg); border:1px solid var(--glass-border); padding:2rem; border-radius:20px; width:90%; max-width:400px; backdrop-filter:blur(10px);">
                    <h3 style="color:white; margin-bottom:1rem;">GitHub ì—°ë™ ì„¤ì •</h3>
                    <p style="color:#cbd5e1; font-size:0.8rem; margin-bottom:1rem;">í‰ê°€ ë°ì´í„°ë¥¼ ì €ì¥í•  ì €ì¥ì†Œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    
                    <label style="color:#cbd5e1; font-size:0.9rem;">ì•„ì´ë”” (Owner)</label>
                    <input id="gh_owner" style="width:100%; padding:0.5rem; margin-bottom:0.5rem; background:rgba(0,0,0,0.5); border:1px solid #475569; color:white; border-radius:5px;" value="${githubConfig.owner || ''}">
                    
                    <label style="color:#cbd5e1; font-size:0.9rem;">ì €ì¥ì†Œ ì´ë¦„ (Repo)</label>
                    <input id="gh_repo" style="width:100%; padding:0.5rem; margin-bottom:0.5rem; background:rgba(0,0,0,0.5); border:1px solid #475569; color:white; border-radius:5px;" value="${githubConfig.repo || ''}">
                    
                    <label style="color:#cbd5e1; font-size:0.9rem;">í† í° (Token)</label>
                    <input type="password" id="gh_token" style="width:100%; padding:0.5rem; margin-bottom:1rem; background:rgba(0,0,0,0.5); border:1px solid #475569; color:white; border-radius:5px;" value="${githubConfig.token || ''}">
                    
                    <div style="display:flex; gap:0.5rem;">
                        <button id="saveGH" style="flex:1; padding:0.5rem; background:linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color:white; border:none; border-radius:5px; cursor:pointer;">ì €ì¥</button>
                        <button id="closeGH" style="flex:1; padding:0.5rem; background:#475569; color:white; border:none; border-radius:5px; cursor:pointer;">ë‹«ê¸°</button>
                    </div>
                </div>
             `;
            document.body.appendChild(overlay);
            
            document.getElementById('saveGH').onclick = () => {
                const newConfig = {
                    owner: document.getElementById('gh_owner').value.trim(),
                    repo: document.getElementById('gh_repo').value.trim(),
                    token: document.getElementById('gh_token').value.trim(),
                    // pathëŠ” ì €ì¥í•˜ì§€ ì•Šê±°ë‚˜(ë¬´ì‹œë¨), ì €ì¥í•´ë„ loadConfigì—ì„œ ë¬´ì‹œí•¨.
                    // ì¼ê´€ì„±ì„ ìœ„í•´ pathë„ ë„£ì–´ë‘˜ ìˆ˜ëŠ” ìˆìœ¼ë‚˜ evaluation.htmlì€ eval_data.jsonë§Œ ì¨ì•¼í•¨.
                };
                
                // Save to localStorage just like group_site.html does so they share credentials
                localStorage.setItem('gh_config_v2', JSON.stringify({
                    ...newConfig,
                    path: 'data.json' // Save 'data.json' as default path for group_site compatibility? 
                                      // Or better yet, don't rely on path in localStorage for files that have fixed paths.
                }));
                
                // Update current runtime config
                githubConfig.owner = newConfig.owner;
                githubConfig.repo = newConfig.repo;
                githubConfig.token = newConfig.token;
                
                document.body.removeChild(overlay);
                alert("ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            };
            
            document.getElementById('closeGH').onclick = () => document.body.removeChild(overlay);
        }
    </script>

    </script>
</body>

</html>